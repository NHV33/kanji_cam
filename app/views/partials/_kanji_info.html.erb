<div class="box col-12 mt-4">

  <div class="row">

    <div class="col-3"><span>JLPT: </span>
      <% rank_emoji = ["", "üëπ", "üï∫", "üòé", "üò∫", "üê£"] %>
      <h3>
        N<%= @card.kanji.jlpt %><%= " #{rank_emoji[@card.kanji.jlpt]}" %>
      </h3>
    </div>

    <div class="col-6">
      <div class="text-center">

        <h1 id="kanji-symbol" style="font-size: 140px;">
          <!-- Displays character saved on Card instance -->
          <%= @card.character %>
        </h1>

        <% if @card.character == @card.kanji.old_form %>
          <span class="fs-4" style="white-space: nowrap;">
            <%= "(old form of #{@card.kanji.character})" %>
          </span>
        <% end %>

      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-sm-6 col-md-6 mx-auto">

          <p class="mb-0 text-left fs-5">
            <strong><%= @card.kanji.strokes %></strong> strokes
          </p>

          <% if @card.kanji.grade <= 6 %>
            <p class="mb-0 fs-5">taught in grade <%= @card.kanji.grade %></p>
          <% elsif @card.kanji.grade == 7 %>
            <p class="mb-0 fs-5">taught in junior high</p>
          <% end %>

          <p class="mb-0 fs-5">
            Radical: <strong><%= @card.kanji.radical %></strong>
          </p>

        </div>
      </div>
    </div>
  </div>

</div>

<div class="box mt-3 col-12">

  <div>
    <p class="mb-0">Meanings (ÊÑèÂë≥): </p>
    <h2><%= @card.kanji.meanings.join(", ") %></h2>
  </div>

  <!-- Do we need to show the first meaning in a separate place?
  <div>
    <p class="mb-0">1st meaning: </p>
    <h2><%= @card.kanji.meanings[0] %></h2>
  </div>
  -->

  <%# External Link to Advanced Readings %>
  <% kanji_to_search = @card.kanji.character %>
  <% encoded_kanji = URI.encode_www_form_component(kanji_to_search) %>
  <% advanced_url = "https://jisho.org/search/#{encoded_kanji}%20%23kanji" %>


  <div data-controller="tts" class="tts-controller">
  <div data-controller="furigana" class="furigana-controller">

  <%# On & Kun Readings Section + Example Sentences -- Includes TTS and romaji functionality %>
  <div class="mt-4">

    <div class="d-flex mb-2">
      <span class="badge bg-warning" style="font-size: 16px; width: 50px; border-radius: 4px">On</span>

      <h3 class="mb-0 ms-2">

        <% if @card.kanji.on_readings.blank? %>
          <p class="mb-0"><%= "No commonly used on reading." %></p>
          <a class="fs-5" href="<%= advanced_url %>" target="_blank" rel="noopener noreferrer">See advanced readings</a>
        <% else %>
          <%# Loop through each on reading and create a div tag with a clickable sound icon %>
          <% @card.kanji.on_readings.each do |reading| %>
            <div class="reading" >
              <%= reading %>
              <i class="sound-icon fa-solid fa-volume-high ms-2 icon-link icon-link-hover" ></i>
            </div>
          <% end %>
        <% end %>

      </h3>

    </div>

    <div class="d-flex mb-2">
      <span class="badge bg-primary" style="font-size: 16px; width: 50px; border-radius: 4px">Kun</span>

      <h3 class="mb-0 ms-2">

        <% if @card.kanji.kun_readings.blank? %>
          <p class="mb-0 fs-4"><%= "No commonly used kun reading." %></p>
          <a class="fs-5" href="<%= advanced_url %>" target="_blank" rel="noopener noreferrer">See advanced readings</a>
        <% else %>
          <%# Loop through each kun reading and create a div tag with a clickable sound icon %>
          <% @card.kanji.kun_readings.each do |reading| %>
            <div class="reading" >
              <%= reading %>
              <i class="sound-icon fa-solid fa-volume-high ms-2 icon-link icon-link-hover" ></i>
            </div>
          <% end %>
        <% end %>

      </h3>

    </div>

  </div>

  <% kanji_to_search = @card.kanji.character %>
  <% @jpn_sentences, @eng_sentences = Scraper.new(kanji_to_search).scrape %>

  <h2 class="mt-4">Example Sentences</h2>

  <% unless @jpn_sentences.empty? %>
    <% @jpn_sentences.zip(@eng_sentences)[0..2].each_with_index do |(japanese, english), index| %>
      <div class="bg-info-subtle p-2 mb-3">

        <p class="mb-0 fs-6">
          <%= japanese.html_safe %>
          <i class="sound-icon fa-solid fa-volume-high ms-2 icon-link icon-link-hover" ></i>
        </p>

        <p class="mb-0"><%= english.html_safe %></p>
      </div>
    <% end %>
  <% end %>

  </div> <!-- furigana-controller div -->
  </div> <!-- TTS-controller div -->

</div>
